library(survival)
library(foreign)
library(ggplot2)
library(survminer)
library(rms)
library(flexsurv)
library(dplyr)
library(ciTools)
library(here)
library(visreg)
library(cmprsk)
hurricane <- read.csv("https://github.com/sjsimmo2/Survival/raw/master/hurricane.csv")
head(hurricane)
hurricane <- data.frame(lapply(hurricane, function(x) as.factor(x)))
hurricane$hour <- as.numeric(hurricane$hour)
hurricane$age <- as.numeric(hurricane$age)
hurricane$slope <- as.numeric(hurricane$slope)
hurricane$elevation <- as.numeric(hurricane$elevation)
str(hurricane)
describe(hurricane)
hurricane_missing <- hurricane[rowSums(is.na(hurricane)) > 0,]
hurricane$censor <- ifelse(hurricane$survive == 1, 0, 1)
#Survival Analysis Object
hurricane.surv = Surv(time=hurricane$hour,event=hurricane$censor)
hurricane.km=survfit(Surv(time=hour,event=censor)~1, data = hurricane)
summary(hurricane.km)
plot(hurricane.km, main = "Survival Function", xlab = "Tenure", ylab = "Survival Probability")
#Hazard function
h = hurricane.km$n.event/hurricane.km$n.risk
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(hurricane.km$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
#Cumulative hazard
ggsurvplot(hurricane.km, data = hurricane, fun = "cumhaz", conf.int = TRUE,  palette = "blue", xlab = "Week",
ylab = "Cumulative Hazard", legend = "none")
ggsurvplot(
hurricane.km,
data = hurricane,
size = 1,
palette = "blue",
conf.int = TRUE,
risk.table = TRUE,
risk.table.height = 0.25,
ggtheme = theme_bw()
)
#Stratified Survival analysis
reason.surv = survfit(Surv(time=hour,event=censor)~reason, data = hurricane)
ggsurvplot(reason.surv, data=hurricane, palette = c("blue","orange","red","purple","yellow"),conf.int = T)
#Test differences
survdiff(Surv(time=hour,event=censor)~reason, data = hurricane, rho = 0)
survdiff(Surv(time=hour,event=censor)~reason, data = hurricane, rho = 1)
#Hazard function
h = hurricane.km$n.event/hurricane.km$n.risk
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(hurricane.km$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
#Cumulative hazard
ggsurvplot(reason.surv, data = hurricane, fun = "cumhaz", conf.int = TRUE,  palette = c("blue","orange","red","purple","yellow"), xlab = "Week",
ylab = "Cumulative Hazard", legend = "none")
ggsurvplot(
reason.surv,
data = hurricane,
size = 1,
palette =
c("blue","orange","red","purple","yellow"),
conf.int = TRUE,
pval = TRUE,
risk.table = TRUE,
legend.labs =
c("0", "1", "2", "3", "4"),
risk.table.height = 0.25,
ggtheme = theme_bw()
)
hurricane[hurricane$reason %in% c("0",'1','2','3','4'),]
hurricane[hurricane$reason == "1",]
reason_1 <- hurricane[hurricane$reason == "1",]
View(reason_1)
reason_0 <- hurricane[hurricane$reason == "0",]
reason_1 <- hurricane[hurricane$reason == "1",]
reason_2 <- hurricane[hurricane$reason == "2",]
reason_3 <- hurricane[hurricane$reason == "3",]
reason_4 <- hurricane[hurricane$reason == "4",]
316+115+112+111+116
desc(reason_0)
describe(reason_0)
describe(reason_0$survive)
describe(hurricane$survive)
describe(hurricane$reason)
avg(reason_1$hour)
mean(reason_1$hour)
mean(reason_1$hour)
mean(reason_2$hour)
mean(reason_3$hour)
mean(reason_4$hour)
survdiff(Surv(time=hour,event=censor)~reason, data = hurricane, rho = 0)
#Test differences
logrank <- survdiff(Surv(time=hour,event=censor)~reason, data = hurricane, rho = 0)
summary(logrank)
logrank
h = hurricane.km$n.event/hurricane.km$n.risk
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(hurricane.km$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
h = reason.surv$n.event/reason.surv$n.risk
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(reason.surv$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
#Hazard function
reason.surv$n.risk
ggsurvplot(
reason.surv,
data = hurricane,
size = 1,
palette =
c("blue","orange","red","purple","yellow"),
conf.int = TRUE,
pval = TRUE,
risk.table = TRUE,
legend.labs =
c("0", "1", "2", "3", "4"),
risk.table.height = 0.25,
ggtheme = theme_bw())
summary(reason.surv)
#Hazard function
reason.surv$n.risk
#Hazard function
reason.surv$n.risk[2,49]
#Hazard function
reason.surv$n.risk[2:49]
#Hazard function
reason.surv$n.risk[2:46]
46+45
reason.surv$n.risk[47:91]
reason.surv$n.risk[47:80]
reason.surv$n.risk[47:70]
reason.surv$n.risk[71:100]
reason.surv$n.risk[71:98]
reason.surv$n.risk[99:]
reason.surv$n.risk[99:,]
h = reason.surv$n.event/reason.surv$n.risk
reason.surv$n.event
reason.surv$n.risk
reason.surv$n.risk[99:120]
reason.surv$n.risk[99:121]
reason.surv$n.risk[99:119]
reason.surv$n.event
i =reason.surv$n.event
f = reason.surv$n.risk
h = reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(reason.surv$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
reason_0 <- hurricane[hurricane$reason == "0",]
reason_1 <- hurricane[hurricane$reason == "1",]
reason_2 <- hurricane[hurricane$reason == "2",]
reason_3 <- hurricane[hurricane$reason == "3",]
reason_4 <- hurricane[hurricane$reason == "4",]
h = reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
index.h=rep(0,length=(max(reason_1$hour)+1)) #Need to add 0
index.h[(reason.surv$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(reason_1$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
h = reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(reason.surv$time)+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
reason.surv$time
h = reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(reason.surv$time[2:46])+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h))
colnames(haz.plot)=c("Time","Hazard")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
h = reason.surv$n.event[2:46]/reason.surv$n.risk[2:46]
index.h=rep(0,length=(max(hurricane$hour)+1)) #Need to add 0
index.h[(reason.surv$time[2:46])+1]=h #Because of 0
haz.plot=data.frame(cbind(seq(0,max(hurricane$hour)), index.h,c(1)))
colnames(haz.plot)=c("Time","Hazard", "reason")
ggplot(haz.plot,aes(x=Time,y=Hazard))+geom_line()
View(haz.plot)
